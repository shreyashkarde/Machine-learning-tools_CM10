<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TF.js Linear Regression Lab</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; padding: 40px; background: #f0f2f5; text-align: center; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: inline-block; }
        .status { color: #1a73e8; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Linear Regression: Synthetic Data</h2>
        <p>Formula: <code>y = 3x - 1</code></p>
        <div id="status" class="status">Initializing TensorFlow...</div>
        <p>Check the <strong>Browser Console (F12)</strong> for detailed logs.</p>
    </div>

    <script>
        async function runLab() {
            const status = document.getElementById('status');

            // 1. Prepare Synthetic Data (y = 3x - 1)
            // xs: Input features, ys: Labels
            const xs = tf.tensor2d([-1, 0, 1, 2, 3, 4], [6, 1]);
            const ys = tf.tensor2d([-4, -1, 2, 5, 8, 11], [6, 1]);

            // 2. Define Model Architecture
            const model = tf.sequential();
            model.add(tf.layers.dense({ units: 1, inputShape: [1] }));

            // 3. Compile Model
            // sgd = Stochastic Gradient Descent
            model.compile({
                optimizer: tf.train.sgd(0.1), 
                loss: 'meanSquaredError'
            });

            // 4. Train the Model
            status.innerText = "Training in progress...";
            console.log("Training started...");

            await model.fit(xs, ys, {
                epochs: 100,
                callbacks: {
                    onEpochEnd: (epoch, logs) => {
                        if (epoch % 20 === 0) {
                            console.log(`Epoch ${epoch}: Loss = ${logs.loss.toFixed(4)}`);
                        }
                    }
                }
            });

            status.innerText = "Training Complete!";
            console.log("Training completed.");

            // 5. Perform Prediction
            // If x = 10, then y = 3(10) - 1 = 29
            const testVal = 10;
            const prediction = model.predict(tf.tensor2d([testVal], [1, 1]));
            
            const result = prediction.dataSync()[0];
            console.log(`Prediction for x=${testVal}:`, result);
            
            status.innerHTML = `Training Complete!<br>Prediction for x=${testVal} is <b>${result.toFixed(2)}</b>`;
            
            // 6. Clean up memory
            xs.dispose();
            ys.dispose();
            prediction.dispose();
        }

        // Start the process
        runLab();
    </script>
</body>
</html>